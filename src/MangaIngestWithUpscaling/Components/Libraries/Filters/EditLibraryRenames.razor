@using MangaIngestWithUpscaling.Data.LibraryManagement
@using MangaIngestWithUpscaling.Helpers
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<EditLibraryRenames> Loc

<MudStack>
    <MudText Typo="Typo.h5">@Loc["Title"]</MudText>
    <MudText Typo="Typo.body1">
        @Loc["Description"]
    </MudText>

    <MudTable T="LibraryRenameRule" Items="@Library.RenameRules" Dense>
        <HeaderContent>
            <MudTh>@Loc["Header_Pattern"]</MudTh>
            <MudTh>@Loc["Header_PatternType"]</MudTh>
            <MudTh>@Loc["Header_TargetField"]</MudTh>
            <MudTh>@Loc["Header_Replacement"]</MudTh>
            <MudTh>
                <MudIconButton Icon="@Icons.Material.Filled.Add"
                    OnClick="async () => { Library.RenameRules.Add(new()); await RulesChanged.InvokeAsync(); }" />
            </MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="@Loc["Header_Pattern"]">@context.Pattern</MudTd>
            <MudTd DataLabel="@Loc["Header_PatternType"]">@context.PatternType.GetDisplayName()</MudTd>
            <MudTd DataLabel="@Loc["Header_TargetField"]">@context.TargetField.GetDisplayName()</MudTd>
            <MudTd DataLabel="@Loc["Header_Replacement"]">@context.Replacement</MudTd>
            <MudTd>
                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error"
                    OnClick="async () => { Library.RenameRules.Remove(context); await RulesChanged.InvokeAsync(); }" />
            </MudTd>
        </RowTemplate>
        <RowEditingTemplate>
            <EditLibraryRenameForm RenameRule="@context" RulesChanged="RulesChanged" />
        </RowEditingTemplate>
    </MudTable>
</MudStack>

@code {
    [Parameter] public required Library Library { get; set; }
    [Parameter] public EventCallback RulesChanged { get; set; }
}