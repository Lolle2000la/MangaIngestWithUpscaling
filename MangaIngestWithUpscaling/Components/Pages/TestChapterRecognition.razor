@page "/TestChapterRecognition"
@using MangaIngestWithUpscaling.Components.FileSystem
@using MangaIngestWithUpscaling.Services.ChapterRecognition

@inject IChapterInIngestRecognitionService recognitionService

<MudText Typo="Typo.h4">TestChapterRecognition</MudText>

<FolderPicker SelectedPathChanged="OnPathSelected" />

@if (folderPath != null)
{
    <MudTable T="FoundChapter" Items="@foundChapters">
        <HeaderContent>
            <MudTh>Series</MudTh>
            <MudTh>Chapter</MudTh>
            <MudTh>Filename</MudTh>
            <MudTh>Relative Path</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.Metadata.Series</MudTd>
            <MudTd>@context.Metadata.ChapterTitle</MudTd>
            <MudTd>@context.FileName</MudTd>
            <MudTd>@context.RelativePath</MudTd>
        </RowTemplate>
    </MudTable>
}

@code {
    private string? folderPath;
    private List<FoundChapter> foundChapters = new();

    private void OnPathSelected(string path)
    {
        folderPath = path;
        if (folderPath != null)
            foundChapters = recognitionService.FindAllChaptersAt(path);
    }
}
