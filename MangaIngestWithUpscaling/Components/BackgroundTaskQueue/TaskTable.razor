@using MangaIngestWithUpscaling.Data.BackqroundTaskQueue

<MudTable T="PersistedTask" Items="@Tasks" RowsPerPage="10" Elevation="3"
          @ref="Table">
    <ToolBarContent>
        <MudText Typo="Typo.h6">@Title</MudText>
    </ToolBarContent>
    <HeaderContent>
        <MudTh><MudTableSortLabel InitialDirection="SortDirection.Descending" SortBy="new Func<PersistedTask, object>(x=>x.Id)">Id</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PersistedTask, object>(x=>x.Data.TaskFriendlyName)">Name</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PersistedTask, object>(x=>x.CreatedAt)">Queued At</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PersistedTask, object>(x=>x.ProcessedAt)">Finished At</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PersistedTask, object>(x=>x.Status)">Status</MudTableSortLabel></MudTh>

    </HeaderContent>
    <RowTemplate>
        <MudTd>@context.Id</MudTd>
        <MudTd>@context.Data.TaskFriendlyName</MudTd>
        <MudTd>@context.CreatedAt</MudTd>
        <MudTd>@context.ProcessedAt</MudTd>
        <MudTd>@context.Status</MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>

@code {
    [Parameter] public IReadOnlyCollection<PersistedTask> Tasks { get; set; } = [];
    [Parameter] public string Title { get; set; } = "Tasks";

    private MudTable<PersistedTask> Table { get; set; } = null!;

    protected override void OnParametersSet()
    {
        Tasks = new List<PersistedTask>(Tasks);
    }
}
